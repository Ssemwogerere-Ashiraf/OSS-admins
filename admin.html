<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin – Outreach SS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
    header { background: #b71c1c; color: white; padding: 1rem; text-align: center; }
    form { margin: 2rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.1); }
    input, textarea { width: 100%; padding: .5rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: .6rem 1rem; border: none; border-radius: 5px; cursor: pointer; }
    .save-btn { background: #b71c1c; color: white; }
    .delete-btn { background: crimson; color: white; margin-right: .5rem; }
    .edit-btn { background: darkblue; color: white; }
    ul { list-style: none; padding: 0; margin: 2rem; display: grid; gap: 1rem; }
    li { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,.1); transition: transform .2s; }
    li:hover { transform: scale(1.02); }
    li strong { font-size: 1.2rem; color: #b71c1c; }
    li em { display: block; margin-top: .5rem; color: #555; }
    li small { color: #888; }
    img { max-width: 150px; margin-top: .5rem; border-radius: 4px; }

    /* Center the form container */
.form-container {
  max-width: 600px;        /* limit width */
  margin: 2rem auto;       /* center horizontally */
  padding: 2rem;           /* spacing inside */
  background: #fff;        /* white background */
  border-radius: 10px;     /* rounded corners */
  box-shadow: 0 4px 12px rgba(0,0,0,.15); /* subtle shadow */
}

/* Optional: center the heading above the form */
.form-container h2 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #b71c1c;
}

/* Input fields */
.form-container input,
.form-container textarea,
.form-container select,
.form-container button {
  width: 100%;
  padding: .75rem;
  margin: .5rem 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
}

/* Button styling */
.form-container button {
  background: #b71c1c;
  color: #fff;
  border: none;
  cursor: pointer;
  transition: background .3s;
}

.form-container button:hover {
  background: #a31414;
}

/* Responsive tweaks */
@media (max-width: 768px) {
  .form-container {
    margin: 1rem;
    padding: 1.5rem;
  }
}

@media (max-width: 480px) {
  .form-container {
    padding: 1rem;
  }
  .form-container h2 {
    font-size: 1.2rem;
  }
}
  </style>
</head>
<body>
<script>
  async function checkAuth() {
    const params = new URLSearchParams(window.location.search);
    const auth = params.get("auth");

    // Ask Apps Script for the current valid token
    const response = await fetch("https://script.google.com/macros/s/AKfycbyi8asG95HYAy_QGQzYUXOJBmM4SZwBdK6I0-AohA5w6nbwFbccY5YcAphvY6yfot3_oA/exec");
    const lastToken = await response.text();

    if (lastToken === "EXPIRED" || auth !== lastToken) {
      alert("Session expired or unauthorized. Please log in again.");
      window.location.href = "index.html";
    }
  }

  window.onload = checkAuth;
</script>

<header>
  <h1>Outreach Secondary School – Admin Panel</h1>
  <button onclick="logout()" style="float:right;background:white;color:#b71c1c;border:none;padding:.5rem 1rem;border-radius:5px;cursor:pointer;">Logout</button>
</header>

<div  class="form-container">
  <form id="newsForm">
    <input type="hidden" id="editIndex" value="">
    <label>Title:<br><input type="text" id="title" required></label>
    <label>Content:<br><textarea id="content" required></textarea></label>
    <label>Category:<br><input type="text" id="category"></label>
    <label>Image URL:<br><input type="url" id="image" placeholder="e.g. images/news1.jpg"></label>
    <label>Upload Image:<br><input type="file" id="imageFile" accept="image/*"></label>
    <button type="submit" class="save-btn">Save Post</button>
  </form>

  <div style="margin: 2rem;">
    <button id="clearNewsBtn">Clear All News</button>
    <span id="clearStatus" style="margin-left:.5rem;color:#666"></span>
  </div>

  <h2 style="margin-left:2rem;">Saved Posts</h2>
  <ul id="postList"></ul>
</div>
  <script>
    function logout() {
      window.location.href = "login.html";
    }
    function getBase64(file, callback) {
      const reader = new FileReader();
      reader.onload = () => callback(reader.result);
      reader.readAsDataURL(file);
    }

    document.getElementById('newsForm').addEventListener('submit', function(e){
      e.preventDefault();
      const posts = JSON.parse(localStorage.getItem('newsPosts') || '[]');
      const editIndex = document.getElementById('editIndex').value;

      const fileInput = document.getElementById('imageFile');
      if (fileInput.files.length > 0) {
        getBase64(fileInput.files[0], function(base64Image){
          savePost(posts, editIndex, base64Image);
        });
      } else {
        savePost(posts, editIndex, document.getElementById('image').value);
      }
    });

    function savePost(posts, editIndex, imageValue) {
      const newPost = {
        title: document.getElementById('title').value,
        content: document.getElementById('content').value,
        category: document.getElementById('category').value,
        image: imageValue,
        time: new Date().toISOString()
      };

      if (editIndex !== "") {
        posts[editIndex] = newPost;
        document.getElementById('editIndex').value = "";
        alert('Post updated!');
      } else {
        posts.push(newPost);
        alert('Post saved!');
      }

      localStorage.setItem('newsPosts', JSON.stringify(posts));
      document.getElementById('newsForm').reset();
      loadPosts();
    }

    function loadPosts() {
      const posts = JSON.parse(localStorage.getItem('newsPosts') || '[]');
      const list = document.getElementById('postList');
      list.innerHTML = '';
      posts.forEach((post, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${post.title}</strong> (${post.category || 'Uncategorized'})<br>
          <em>${post.content}</em><br>
          ${post.image ? `<img src="${post.image}" alt="${post.title}">` : ''}
          <br><small>Posted: ${new Date(post.time).toLocaleString()}</small><br><br>
          <button class="delete-btn" onclick="deletePost(${index})">Delete</button>
          <button class="edit-btn" onclick="editPost(${index})">Edit</button>
        `;
        list.appendChild(li);
      });
    }

    function deletePost(index) {
      const posts = JSON.parse(localStorage.getItem('newsPosts') || '[]');
      if (confirm("Are you sure you want to delete this post?")) {
        posts.splice(index, 1);
        localStorage.setItem('newsPosts', JSON.stringify(posts));
        loadPosts();
      }
    }

    function editPost(index) {
      const posts = JSON.parse(localStorage.getItem('newsPosts') || '[]');
      const post = posts[index];
      document.getElementById('title').value = post.title;
      document.getElementById('content').value = post.content;
      document.getElementById('category').value = post.category;
      document.getElementById('image').value = post.image.startsWith('data:') ? '' : post.image;
      document.getElementById('editIndex').value = index;
      alert('Loaded post into form. Make changes and click Save.');
    }

    document.getElementById('clearNewsBtn').addEventListener('click', () => {
      const ok = confirm('This will permanently remove all saved news posts. Continue?');
      if (!ok) return;
      localStorage.removeItem('newsPosts');
      document.getElementById('clearStatus').textContent = 'Cleared';
      loadPosts();
      alert('All news posts removed.');
    });

    loadPosts();

  let timeout;
  function resetTimer() {
    clearTimeout(timeout);
    timeout = setTimeout(() => {
      alert("Session expired. Please log in again.");
      window.location.href = "index.html";
    }, 15 * 60 * 1000); // 15 minutes
  }

  window.onload = resetTimer;
  document.onmousemove = resetTimer;
  document.onkeypress = resetTimer;
  </script>
</body>
</html>
